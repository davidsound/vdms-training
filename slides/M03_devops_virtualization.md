layout: true

.footer-picture[![Network to Code Logo](slides/media/Footer2.PNG)]
.footnote-left[(C) 2015 Network to Code, LLC. All Rights Reserved. ]
.footnote-con[CONFIDENTIAL]

---

class: center, middle, title
.footer-picture[<img src="slides/media/Footer1.PNG" alt="Blue Logo" style="alight:middle;width:350px;height:60px;">]

# DevOps tools : VirtualBox & Vagrant


---

# Module Overview

- Introduction to VirtualBox
- Introduction to Vagrant
---

# VirtualBox

VirtualBox is a cross-platform virtualization application, that can run multiple operating systems as virtual machines the same time. 

Typical use cases:
- Testing and disaster recovery
- Infrastructure consolidation
- Evaluating Software


---
# VirtualBox terminology

- **Host operating system (host OS)**: This is the operating system of the physical computer on which VirtualBox was installed. There are versions of VirtualBox for Windows, Mac OS X, Linux and Solaris hosts
- **Guest operating system (guest OS)**: This is the operating system that is running inside the virtual machine
- **Virtual machine (VM)**:This is the special environment that VirtualBox creates for the guest operating system. 
- **Guest Additions**: Special software packages which are shipped with VirtualBox but designed to be installed inside a VM to improve performance of the guest OS and to add extra features    


Examples of guest additions:
- Mouse pointer integration
- Shared folders
- Time Sync
- Shared clipboard
- Credential passing

---
# VirtualBox manager

When starting for the first time:


<img src="slides/media/vbox_vagrant/virtualbox-main-empty.png" alt="Pep8" style="align:middle:;width:750px;height:400px;">


---
# VirtualBox manager

After installing and configuring VirtualBox

<img src="slides/media/vbox_vagrant/virtualbox-main.png" alt="Pep8" style="align:middle:;width:750px;height:400px;">

---
# Network adapters

VirtualBox provides up to eight virtual PCI Ethernet cards for each virtual machine. For each such card, you can individually select

1. The hardware that will be virtualized as well as

2. The virtualization mode that the virtual card will be operating in with respect to your physical networking hardware on the host.


---
# Network adapter hardware 

For each card, you can individually select what kind of hardware will be presented to the virtual machine. VirtualBox can virtualize the following six types of networking hardware:

AMD PCNet PCI II (Am79C970A);

**AMD PCNet FAST III (Am79C973, the default);**

Intel PRO/1000 MT Desktop (82540EM);

Intel PRO/1000 T Server (82543GC);

Intel PRO/1000 MT Server (82545EM);

Paravirtualized network adapter (virtio-net).

---

# Network adapter modes


- **Not attached**: Network card present but not connected
- **Network Address Translation (NAT)**: Default mode, uses host's network settings for external connectivity
- **Host-only networking**: A virtual network interface (similar to a loopback interface) is created on the host, providing connectivity among virtual machines and the host.
- **Internal networking**: Software-based network which is visible to selected virtual machines, but not to applications running on the host or to the outside world.
- **Bridged networking**: When enabled, VirtualBox connects to one of your installed network cards and exchanges network packets directly, circumventing your host operating system's network stack.


---
# Demo/Guided Lab

- Demo



---
# Lab Time

- Lab 37 - Installing VirtualBox
- Lab 38 - Virtualizing JUNOS
- Lab 39 - Virtualizing Arista

---


class: ubuntu
# Vagrant

Vagrant is a open source tool for working with virtual environments. Vagrant acts as a wrapper and  sits on top of the virtualization solution (VMware, Hyper-V ,Virtual Box or libvirt)  and provides a simple command line interface to manage the VM's with the custom configuration. 

Vagrant is simple and powerful:

```
$ vagrant init hashicorp/precise64   

```

```

$ vagrant up
Bringing machine 'default' up with 'virtualbox' provider... 
==> default: Importing base box 'hashicorp/precise64'... 
==> default: Forwarding ports... 
default: 22 (guest) => 2222 (host) (adapter 1) 
==> default: Waiting for machine to boot...   

```

```

$ vagrant ssh
vagrant@precise64:~$ 
```

---

class: ubuntu
# Vagrant

- By default syncs (shares) the host's directory to the VM as `/vagrant`
- Allows for use of the host's rich ecosystem to manipulate files that can then be used within the VM seamlessly

>NOTE: This requires VM guest additions to be installed. Important if you are trying to use a custom box


---

class: ubuntu
# Configuring Vagrant 

Vagrant is configured using a `Vagrantfile`. A default Vagrantfile is generated by typing `vagrant init` within a directory

Default Vagrantfile:

```
# -*- mode: ruby -*-
# vi: set ft=ruby :

# All Vagrant configuration is done below. The "2" in Vagrant.configure
# configures the configuration version (we support older styles for
# backwards compatibility). Please don't change it unless you know what
# you're doing.
Vagrant.configure("2") do |config|
  # The most common configuration options are documented and commented b
elow.
  # For a complete reference, please see the online documentation at
  # https://docs.vagrantup.com.

  # Every Vagrant development environment requires a box. You can search
 for
  # boxes at https://atlas.hashicorp.com/search.
  config.vm.box = "base"
.
.
.
.
.
<output truncated for readability>
```
---


class: ubuntu
# Configuring Vagrant


Default configuration without the comments

```
[ntc@ntc ~]$ grep -v "#" Vagrantfile

Vagrant.configure("2") do |config|

  config.vm.box = "base"








end

```
---


class: ubuntu

# Vagrant configuration - Linux VM



```
Vagrant.configure("2") do |config|
  config.vm.box = "centos/7"
  config.vm.provision :shell, path: "bootstrap.sh"
  config.vm.network "forwarded_port", guest: 80, host: 8080
end
```

- `config.vm.box = "centos/7"`: the box name.
- `config.vm.provision :shell, path: "bootstrap.sh"`: we're choosing to run the `bootstrap.sh` custom script during boot to provision our vagrant box.
- `config.vm.network "forwarded_port", guest: 80, host: 8080`: we're building a mapping between port 80 on local machine and port 8080 on the virtual machine.

---

class: ubuntu
# Vagrant commands

- `vagrant up`: Brings up a Vagrant machine
- `vagrant ssh`: Logs the user into the running machine
- `vagrant reload`: Restarts a Vagrant machine
- `vagrant halt`: Stops a Vagrant machine
- `vagrant provision`: Runs the "provisioner" on a running VM
- `vagrant destroy`: Stops and deletes the VM
- `vagrant status` : Status of the VM
- `vagrant global-status`: Status of all vagrant VMs 

---

class: ubuntu

# Vagrant configuration - provisioners

Provisioners in Vagrant allow you to automatically install software, alter configurations.
This allows for automation using scripts and tools like Ansible, Chef, Puppet etc.

Provisioning happens at certain points during the lifetime of the Vagrant environment:

- On the first vagrant up that creates the environment, provisioning is run. If the environment was already created and the up is just resuming a machine or booting it up, they will not run unless the --provision flag is explicitly provided.

- When `vagrant provision` is used on a running environment.

- When `vagrant reload --provision` is called. The --provision flag must be present to force provisioning.


---

class: ubuntu

# Vagrant provisioner - Shell script


Use simple shell commands to configure and install packages and software on boot.

```
# install pip
curl "https://bootstrap.pypa.io/get-pip.py" -o "get-pip.py"
sudo python get-pip.py

# install network libraries
sudo pip install netmiko
sudo pip install napalm

```

---
# Lab Time

- Lab 40 - Installing Vagrant
- Lab 41 - Vagrant CentOS 


---

class: ubuntu
# Vagrant Plugins

Plugins are powerful, first-class citizens that extend Vagrant using a well-documented, stable API that can withstand major version upgrade

Plugins are installed using vagrant `plugin install`:


```
ntc@ntc:~$ vagrant plugin install vagrant-junos
Installing the 'vagrant-junos' plugin. This can take a few minutes...
Fetching: vagrant-junos-0.2.1.gem (100%)
Installed the plugin 'vagrant-junos (0.2.1)'!
```

Once a plugin is installed, it will automatically be loaded by Vagrant. 

---

class: ubuntu
# Adding a custom box 

The `vagrant box add` command can be used to add custom boxes


```
ntc@ntc:~$ vagrant box add juniper/ffp-12.1X47-D15.4-packetmode
==> box: Loading metadata for box 'juniper/ffp-12.1X47-D15.4-packetmode'
    box: URL: https://vagrantcloud.com/juniper/ffp-12.1X47-D15.4-packetmode
This box can work with multiple providers! The providers that it
can work with are listed below. Please review the list and choose
the provider you will be working with.

1) virtualbox
2) vmware_desktop

Enter your choice: 1
==> box: Adding box 'juniper/ffp-12.1X47-D15.4-packetmode' (v0.5.0) for provider: virtualbox
    box: Downloading: https://vagrantcloud.com/juniper/boxes/ffp-12.1X47-D15.4-packetmode/versions/0.5.0/providers/virtualbox.box
==> box: Successfully added box 'juniper/ffp-12.1X47-D15.4-packetmode' (v0.5.0) for 'virtualbox'!
```

---
# Lab Time

- Lab 42 - Vagrant JUNOS box

---

class: ubuntu

# Bringing up a full topology using vagrant


Private network interconnections can be defined using the `Vagrantfile`.



**Example:**

- Connect a CentOS box to a private network using virtualbox internal network

```
#Vagrantfile network entry 
    centos.vm.network "private_network", virtualbox__intnet: "link_1", ip: "169.254.1.10"
```

- Connect a Juniper box to the same private network:

```
#Vagrantfile network entry 

    junos.vm.network "private_network", virtualbox__intnet: "link_1", ip: "169.254.1.11", auto_config: false
```

- Connect an Arista box to the same private network:

```
#Vagrantfile network entry 
    eos.vm.network "private_network", virtualbox__intnet: "link_1", ip: "169.254.1.13", auto_config: false
```

---
# Lab Time

- Lab 43 - Using Vagrant to bring up a complex network 

---
